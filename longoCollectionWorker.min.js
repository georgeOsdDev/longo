/*!
 * longo
 * https://github.com/georgeOsdDev/Longo
 *
 * The MIT License (MIT)
 * Copyright (c) 2014 Takeharu Oshida <georgeosddev@gmail.com>
 */

function ObjectId(){this.val=Date.now()}function noop(){return void 0}function asNoop(){return noop}function aSlice(a){return Array.prototype.slice.apply(a)}function isArray(a){return Array.isArray?Array.isArray(a):"[object Array]"===toString.call(a)}function toArray(a){return isArray(a)?a:[a]}function existy(a){return null!==a&&void 0!==a}function truthy(a){return a!==!1&&existy(a)}function isTrue(a){return a===!0}function isFalse(a){return a===!1}function isNegativeNum(a){return!truthy(a)||_.isNumber(a)&&0>a}function isZero(a){return 0===a}function isOne(a){return 1===a}function isPositiveNum(a){return!isNegative(a)&&!isZero(a)}function doWhen(a,b,c,d){var e=toArray(c);return truthy(a)?b.apply(d,e):void 0}function doWhenOrElse(a,b,c,d,e){var f=toArray(d);return truthy(a)?b.apply(e,f):c.apply(e,f)}function roughSizeOfObject(a){for(var b=[],c=[a],d=0;c.length;){var e=c.pop();if("boolean"==typeof e)d+=4;else if("string"==typeof e)d+=2*e.length;else if("number"==typeof e)d+=8;else if("object"==typeof e&&-1===b.indexOf(e)){b.push(e);for(var f in e)c.push(e[f])}}return d}function project(a,b){var c,d=_.pairs(b),e=_.filter(d,function(a){return isOne(a[1])||isTrue(a[1])}),f=_.filter(d,function(a){return isZero(a[1])||isFalse(a[1])});return _.size(e)>0?(c=_.pluck(e,"0"),c=isZero(b._id)||isFalse(b._id)?_.without(c,"_id"):_.union(c,["_id"]),_.map(a,function(a){return _.pick(a,c)})):(c=_.pluck(f,"0"),_.map(a,function(a){return _.omit(a,c)}))}importScripts("./lib/underscore/underscore.js");var db=[];self.addEventListener("message",function(a){var b=a.data||{},c=b.cmd||"unknown",d=b.seq||-1,e=[];switch(c){case"start":self.Logger={},self.Logger.log=function(a){console.log("Longo."+b.name+": "+a)},self.Logger.error=function(a){console.error("Longo."+b.name+": "+a)},self.Logger.log("start"),self.postMessage({seq:d,errCd:0});break;case"drop":self.db=null,self.postMessage({seq:d,errCd:0}),self.close();break;case"findAll":e=project(self.db,b.projection),self.postMessage({seq:d,errCd:0,result:e});break;case"save":b.doc._id||(b.doc._id=new ObjectId),self.db.push(b.doc),self.postMessage({seq:d,errCd:0,result:b.doc});break;case"removeAll":self.db=[],self.postMessage({seq:d,errCd:0,result:[]});break;default:self.postMessage({seq:d,errCd:1,result:c+" is not supported."})}},!1);
//# sourceMappingURL=longo.min.map